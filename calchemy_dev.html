<!DOCTYPE html>
<html>

<!-- Calchemy (tm); Math Magic; http://www.calchemy.com -->
<!-- Copyright (c) 1988-2020 Ken Burgess and Rich Testardi. -->
<!-- top, right, bottom, left; max line length 180 -->

<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
<title>Calchemy&trade; -- Math Magic</title>
<style>
a { text-decoration: none; }
#results { line-height: 1.4; }
#equation { width: 96%; font-size:120%; }
#copyright { font-size:75%; padding: 0px; }
html,button,input { font: 36px Arial, Helvetica, sans-serif; padding: 15px; margin: 15px 0px 15px 0px; }
@media(min-width:80em){ html,button,input { font: 24px Arial, Helvetica, sans-serif; padding: 10px; margin: 10px 0px 10px 0px; } }
@supports(-webkit-touch-callout:none) { button,input { -webkit-appearance: none; border-radius: 2px; } }
img { padding: 0px; margin: 10px 10px 0px 0px; }
table,tr,td { margin: 0px; padding: 0px; }
table.table1,table.table2 { width: 100%; }
i.i1 { filter: grayscale(75%) opacity(75%); }
hr { height: 2px; }
body,html { margin: 0px; }
</style>
</head>

<body onload='Body()'>

<h1>Calchemy&trade; -- Math Magic</h1>
<table class='table1'><tr>
<td><p id='status'>loading database ... </p></td>
<td style='text-align: right'><button id='all' type='button' style='margin: 0px;' onclick="Delete('all')">Delete All</button></td>
</tr></table>
<input type="file" id="file" style="display:none">
<p id='results'></p>
<input id='equation' name='equation' placeholder='enter expression ? unit' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false'/>
<br>
<button id='enter' type='button' onclick="Enter()">Enter</button>
<button type='button' onclick="Clear()">Clear</button>
<button type='button' onclick="Units()">Find Units</button>
<button type='button' onclick="Details()">Unit Details</button>
<button type='button' onclick="Copy()">Copy</button>
<button type='button' onclick="Paste()">Paste</button>
<button type='button' onclick="Example()">Example</button>
<button type='button' onclick="Equations()">Equations</button>
<button type='button' onclick="Load()">Load</button>
<button type='button' onclick="Test()">Test</button>
<button type='button' onclick="Help()">Help</button>
<br>
<table class='table2' id='bottom'>
<tr>
<td>
<a href='http://www.calchemy.com' target='_blank'><img alt='Calchemy icon' src='data:image/jpeg;base64,
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'/></a>
</td>
<td>
<p id='copyright'>Copyright &copy; 1988-2020 Ken Burgess and Rich Testardi.
v1.09v</p>
</td>
</tr>
</table>

<script>
'use strict';
var custom = null;
// Coverage test:
//   reload, <Delete All>, <Test>
//   1, <Clear>, 11, <Enter>, 2, <Enter>
//   <Find Units>, Water, abc, <Unit Details>, visc_water, <Enter>
//   f, <Find Units>, furlong, <Unit Details>, <Enter>
//   <Delete> -- all but numbers
//   <Up-arrow>, <Up-arrow>, <Up-arrow>, <Up-arrow>, <Enter>
//   <Down-arrow>, <Enter>
//   <Copy>, <Paste>
//   <Example>, <Enter>
//   <Help>, 3 meter ? inch, <Enter>, <Delete>, <Delete>
//   1&2, <Enter>, Recall 1&2, <Enter>
// 97.7%

// XXX -- for IE, replace template strings with concatenation, replace .includes with .indexOf != -1, class likely has to be removed, too

// database format:
//
//   ... # <comment>  -- optional comment (will be shown in unit definition details)
//   CATEGORY <name>  -- define category name (categories must be defined before use)
//   BASE <name>  -- define base unit name (cannot be undefined)
//   DERIVED <names> = <expression>  -- define coefficient and exponents for a derived dimension name (cannot be undefined)
//   AMBIGUOUS <names> = <expression>  -- like derived, but called out for extra testing (cannot be undefined)
//   PREFIX <names> = <expression>  -- define coefficient for a prefix name (cannot be undefined)
//   [*]<names> = <expression> [? <dimension>]  -- define a unit (* = unit is prefixable)
//   <names> = [? <expression>]  -- undefine a unit
//
//   <names> format:
//     [<category|dimension>[, ...]:]<name>[*][, ...]  -- unit names (* = name is pluralizable)
</script>

<script type="text/javascript" src="database_dev.js">
</script>

<script type="text/javascript" src="engine_dev.js">
</script>

<script type="text/javascript" src="custom.js">
</script>

<script>

// *** html elements ******************************************************************************

// persist new results, scroll the page to the equation line, and set equation focus
function Scroll(noscroll)
{
    // store our results history
    var save = document.getElementById("results").innerHTML.trim();  // XXX -- why space when empty?
    localStorage["calchemy.results"] = save;

    // enable the Delete All button if there are chunks to delete
    document.getElementById("all").disabled = ! save.length;

    // if we're scrolling...
    if (noscroll != true) {
        // scroll the equation line into view and set the focus
        document.getElementById("bottom").scrollIntoView();
        document.getElementById("equation").focus();
        // if needed, scroll us all the way left
        // N.B. some browsers hide our margin otherwise and it looks bad
        var x = window.scrollX, y = window.scrollY;
        if (x < 100) {
            window.scrollTo(0, y);
        }
    }
}

// convert text to hyperlinked html for the history list
function History(text)
{
    var html = text;
    if (html.match(/[#]/)) {
        html = html.replace(/[#]/, "<i class='i1'>#").replace(/$/, "</i>");
    }
    return "<a href=\"javascript:Hyperlink('" + text.replace(/^= /, "") + "')\">" + html + "</a>";
}

var lasttag = "";

// return a tagged html chunk to allow results to be deleted
function Chunk(result, tag)
{
    // create a random tag if one was not specified explicitly
    first = true;
    if (tag == undefined) {
        tag = window.crypto.getRandomValues(new Uint32Array(4)).join('-');
    }
    if (lasttag == "") {
        lasttag = tag;
    }
    // create the chunk as a searchable comment preceded by a horizontal line and followed by a table with a delete button to the right
    var hrtag = "<hr><!--" + tag + "-->";  // N.B. duplicated below
    var head = "<table><tr><td>";
    var button = "</td><td style='width: 4%; vertical-align: bottom;'><button type='button' style='margin: 0px;' onclick='Delete(\"" + tag + "\")'>Delete</button>";
    var tail = "</td></tr></table>";
    return  hrtag + head + result + button + tail;
}

// the user clicked a Delete button; delete tagged html results
function Delete(tag)
{
    if (tag == "all") {
        // delete all chunks
        document.getElementById("results").innerHTML = "";
    } else {
        // find the requested chunk in the results
        var head;
        var mid;
        var tail;
        var orig = document.getElementById("results").innerHTML;
        var hrtag = "<hr><!--" + tag + "-->";  // N.B. duplicated above
        var index = orig.indexOf(hrtag);
        if (index != -1) {
            // delete everything up to the next chunk
            head = orig.slice(0, index);
            mid = orig.slice(index + hrtag.length);
            var nexthr = "<hr>";
            index = mid.indexOf(nexthr);
            if (index != -1) {
                tail = mid.slice(index);
            } else {
                tail = "";
            }
            // update the results
            document.getElementById("results").innerHTML = head.trim() + " " + tail.trim();
        }
    }

    // reset url
    window.history.pushState("", "", window.location.href.replace(/[?#].*/, ""));

    cursor = 0;
    Scroll(true);
}

// snoop the test results and delete tagged html results
function SnoopAndDelete(tag)
{
    // find the requested chunk in the results
    var head;
    var mid;
    var orig = document.getElementById("results").innerHTML;
    var hrtag = "<hr><!--" + tag + "-->";  // N.B. duplicated above
    var index = orig.indexOf(hrtag);
    if (index == -1) {
        return [""];
    }

    // delete everything up to the next chunk
    head = orig.slice(0, index);
    mid = orig.slice(index + hrtag.length);

    // update the results
    document.getElementById("results").innerHTML = head.trim();

    // return the snoop
    var lines = mid.split("<br>");
    var snoops = [];
    for (var i = 0; i < lines.length; i++) {
        var snoop = lines[i].replace(/<\/?[^>]+>/g, " ").replace(/ Delete /g, " ");
        if (snoop.trim().length) {
            snoops.push(snoop);
        }
    }
    return snoops;
}

function LoadRuntimeDatabase(name, text)
{
    try {
        LoadDatabase(text);
        document.getElementById("results").innerHTML += Chunk(name + " loaded");
    } catch (error) {
        // append a deletable chunk with any errors
        document.getElementById("results").innerHTML += Chunk(error);
    }
}

// the user loaded the webpage; initialize the units database
function Body()
{
    var what = "database";

    try {
        // load the units database
        loading = true;
        LoadDatabase(database);
        loading = false;

        // load custom units
        if (custom != null) {
            document.getElementById("status").innerHTML += what + " loaded";
            what = "custom";
            document.getElementById("status").innerHTML += "<br>loading custom ... ";
            LoadDatabase(custom);
        }

        // recall our results history
        var temp = localStorage["calchemy.results"];
        document.getElementById("results").innerHTML = temp != undefined ? temp : "";

        // if we have a query string...
        var index = document.URL.indexOf('?');
        if (index != -1) {
            offset_warn = false;
            cycle_warn = false;
            
            // pretend the user entered the query string thru the UI
            document.getElementById("equation").value = window.unescape(document.URL.slice(index+1));
            Enter();

            // reset url
            window.history.pushState("", "", window.location.href.replace(/[?#].*/, ""));
        }

        document.getElementById("status").innerHTML += what + " loaded";
    } catch (error) {
        document.getElementById("status").innerHTML += "<br>" + error;
    } finally {
        offset_warn = false;
        cycle_warn = false;
    }

    // handle key presses in the user equation
    document.body.addEventListener("keyup", function(event) {
        if (event.keyCode === 13) {
            // enter -- run the command line
            event.preventDefault();
            document.getElementById("enter").click();
        }
        if (event.keyCode === 40) {
            // down arrow -- recall a newer command line
            event.preventDefault();
            UpDown(false);
        }
        if (event.keyCode === 38) {
            // up arrow -- recall an older command line
            event.preventDefault();
            UpDown(true);
        }
    });

    // handle database load events
    document.getElementById("file").addEventListener('input', function() {
        var file = document.getElementById("file").files[0];
        var reader = new FileReader();
        reader.addEventListener('load', function(e) {
            var text = e.target.result;
            try {
                LoadRuntimeDatabase(file.name, text);
            } catch (error) {
                // append a deletable chunk with any errors
                document.getElementById("results").innerHTML += Chunk(error);
            }
        });
        reader.readAsText(file);
    });

    Scroll();
}

// the user clicked the Enter button; run the user command line
function Enter()
{
    var success = false;

    try {
        // get the user command line split by '&'
        var equation = document.getElementById("equation").value;
        var lines = equation.split('&');
        var urls = [];
        var htmls = [];

        for (var k = 0; k < lines.length; k++) {
            // parse the requested dimension from the command line
            var line = lines[k];

            // run the command line
            var results = RunLine(line);
            success = results.success;
            var output = results.output;

            // transform the output into hyperlinked html
            var html = "";
            for (var i = 0; i < output.length; i++) {
                if (output[i].match(/^= /)) {
                    html += "<br>" + History(output[i]);
                } else {
                    html += "<br>" + output[i];
                }
            }

            // if we accessed offset temperature units...
            if (offset_warn && ! offset_warned) {
                html += "<br> Caution: Calculation involves offset temperature units; see Calchemy Help.";
                offset_warned = true;
            }

            // if we accessed units of cycle or revolution...
            if (cycle_warn && ! cycle_warned) {
                html += "<br> Caution: Calculation involves units of cycle or revolution; see Calchemy Help.";
                cycle_warned = true;
            }

            // record output
            if (lines.length > 1 && line.trim().length && success && ! testing) {
                htmls.push("<br>" + History(line) + html);
            } else if (html.length) {
                htmls.push(html);
            }

            urls.push(window.escape(line));

            // stop at first error
            if (! success) {
                break;
            }

            Clear();
        }

        // append a deletable chunk to the results list with the results
        if (equation.length && success && ! testing) {
            document.getElementById("results").innerHTML += Chunk(History(equation) + htmls.join(' '));
            window.history.pushState("", "", window.location.href.replace(/[?#].*/, "") + '?' + urls.join('&'));
        } else if (htmls.length) {
            // N.B. if there is no new output we leave output from before TEST available
            document.getElementById("results").innerHTML += Chunk(htmls.join(' '));
        }
    } catch (error) {
        document.getElementById("results").innerHTML += Chunk(error);
    }
    Scroll();

    return success;
}

var first = true;
var cursor = 0;

// the user typed up-arrow or down-arrow to recall an older or newer command line
function UpDown(up)
{
    // get the list of lines and hyperlinks from the results history
    var html = document.getElementById("results").innerHTML;
    var lines = html.split(/[<>]+/);
    var links = [];
    for (var i = 0; i < lines.length; i++) {
        if (lines[i].match(/javascript:Hyperlink/i)) {
            links.push(lines[i].replace(/.*javascript[:]Hyperlink.[']/i, "").replace(/['].*/, ""));
        }
    }
    if (first && up) {
        // an initial up-arrow recalls the last hyperlink from the results history
        cursor = 0;
    }
    if (links.length) {
        // recall the requested hyperlink from the results history to the equation line
        if (up) {
            // older
            cursor = (cursor+links.length-1)%links.length;
        } else {
            // newer
            cursor = (cursor+1)%links.length;
        }
        document.getElementById("equation").value = links[cursor].replace(/&amp;/g, '&');
        first = false;
    }
    Scroll();
}

// the user clicked the Clear button; clear the user equation
function Clear()
{
    // reset url
    window.history.pushState("", "", window.location.href.replace(/[?#].*/, ""));

    document.getElementById("equation").value = "";
    Scroll();
}

// the user clicked a hyperlink; enter text into the user equation, possibly replacing the word at the cursor
function Hyperlink(string)
{
    var equation = document.getElementById("equation");
    var start = equation.selectionStart;
    var end = equation.selectionEnd;
    // if this is a bare unit
    if (string.match(unit_regexp_all)) {
        // find the start and end of the word at the cursor
        var match = equation.value.slice(0, start).match(unit_regexp_tail);
        if (match) {
            start -= match[0].length;
        }
        match = equation.value.slice(end).match(unit_regexp_head);
        if (match) {
            end += match[0].length;
        }
        // replace the word at the cursor with the hyperlinked string
        equation.value = equation.value.slice(0, start) + string + equation.value.slice(end);
    } else {
        // insert the hyperlinked string at the cursor
        equation.value = equation.value.slice(0, start) + string + equation.value.slice(end);
    }
    // update the selection
    equation.selectionStart = equation.selectionEnd = start + string.length;
    Scroll();
}

// show details for a unit in the user equation
function ShowUnitsDetails(name)
{
    // find all interpretations of the unit
    var more = LookupUnits(name, false, false);

    // for each interpretation of the unit...
    var html = "";
    for (var i = 0; i < more.length; i++) {
        // if the unit is prefixed...
        if (more[i].match('~')) {
            // format the prefix definition and the unit definition side-by-side
            // N.B. the unit definition begins with a '*', which we use to represent the multiplication!
            var prefixunit = more[i].split('~');
            html += "<br>" + LookupUnit(prefixunit[0]).definition + LookupUnit(prefixunit[1]).definition;
        } else {
            // format the unit definition alone
            html += "<br>" + LookupUnit(more[i]).definition;
        }

        // append the dimension of the unit to the unit details
        var tokens = TokenizeLine(more[i]);
        var filter = EvaluateTokens(tokens);
        html += " " + filter.Dimension(false);
    }

    // append a deletable chunk to the results list with the unit details
    document.getElementById("results").innerHTML += Chunk("=== unit details " + name + " ===" + html);
    Scroll();
}

// sort, stably folding upper/lower case
function Sort(array)
{
    array.sort(function(a, b) {
        var compare = a.toLowerCase().localeCompare(b.toLowerCase());
        return compare ? compare : a.localeCompare(b);
    });
}

// show units in a database category or dimension
function ShowUnitsByCategory(category, bydimension)  // or "All Units"
{
    var i, j;
    var names = [];
    if (bydimension != true) {
        // first look for category matches
        for (i = 0; i < units.length; i++) {
            if (! units[i].type) {
                if (units[i].categories.includes(category)) {
                    for (j = 0; j < units[i].names.length; j++) {
                        if (! names.includes(units[i].names[j])) {
                            names.push(units[i].names[j]);
                        }
                    }
                }
            }
        }
    }

    if (! names.length) {
        // then look for dimension matches
        var filter = LookupUnit(category);
        if (filter || category == "All Units") {
            for (i = 0; i < units.length; i++) {
                if (! units[i].type) {
                    if (units[i].Compatible(filter, false)) {
                        for (j = 0; j < units[i].names.length; j++) {
                            if (! names.includes(units[i].names[j])) {
                                names.push(units[i].names[j]);
                            }
                        }
                    }
                }
            }
        }
    }

    // compute the list of hyperlinked units
    Sort(names);
    var html = "";
    for (i = 0; i < names.length; i++) {
        html += "<br>" + History(names[i]);
    }

    // append a deletable chunk to the results list with the units list
    document.getElementById("results").innerHTML += Chunk("=== units in category " + category + " ===" + html);
    Scroll();
}

// show units that can match the unit in the user equation
function ShowUnitsByName(name)
{
    // find all units that match the name
    var i;
    var names = LookupUnits(name, false, true);
    var namesets = [];
    for (i = 0; i < names.length; i++) {
        if (! namesets.includes(names[i])) {
            namesets.push(names[i]);
        }
    }

    // compute the list of hyperlinked units
    Sort(namesets);
    var html = "";
    for (i = 0; i < namesets.length; i++) {
        html += "<br>" + History(namesets[i]);
    }

    // append a deletable chunk to the results list with the units list
    document.getElementById("results").innerHTML += Chunk("=== units by name " + name + " ===" + html);
    Scroll();
}

// show database categories and dimensions
function ShowCategories()
{
    // compute the list of categories and dimensions
    var categories = [];
    for (var i = 0; i < units.length; i++) {
        for (var j = 0; j < units[i].categories.length; j++) {
            if (! categories.includes(units[i].categories[j])) {
                categories.push(units[i].categories[j]);
            }
        }
        if (units[i].type == "DERIVED") {
            if (! categories.includes(units[i].names[0])) {
                categories.push(units[i].names[0]);
            }
        }
    }

    // compute the list of hyperlinked categories and dimensions
    Sort(categories);
    var html = "<br><a href=\"javascript:ShowUnitsByCategory('All Units')\">All Units</a>";
    for (i = 0; i < categories.length; i++) {
        html += "<br>" + "<a href=\"javascript:ShowUnitsByCategory('" + categories[i] + "')\">" + categories[i] + "</a>";
    }

    // append a deletable chunk to the results list with the categories list
    document.getElementById("results").innerHTML += Chunk("=== unit categories ===" + html);
    Scroll();
}

// return the word at the cursor
function Word()
{
    var line = document.getElementById("equation").value;
    var start = document.getElementById("equation").selectionStart;
    var match = line.slice(start).match(unit_regexp_head);
    if (match) {
        start += match[0].length;
    }
    line = line.slice(0, start);
    var word = line.match(unit_regexp_tail);
    return word;
}


// the user clicked the Find Units button; find units requested by the user
function Units()
{
    // if there is a word at the cursor...
    var word = Word();
    if (word) {
        var unit = LookupUnit(word[0]);
        if (unit && unit.type) {
            // do a unit category search
            ShowUnitsByCategory(word[0]);
        } else {
            // do a unit search
            ShowUnitsByName(word[0]);
        }
    } else {
        // do a category search
        ShowCategories();
    }
    Scroll();
}

// the user clicked the Unit Details button; show unit details requested by the user
function Details()
{
    // if there is a word at the cursor...
    var word = Word();
    if (word) {
        // show unit details
        ShowUnitsDetails(word[0]);
    }
    Scroll();
}

// the user clicked the Copy button; copy the history and equation to the clipboard
function Copy()
{
    var text = document.getElementById("results").innerText.replace(/[ \t][ \t]*/g, " ").replace(/ Delete$/gm, "") + "\n\n" + document.getElementById("equation").value;
    navigator.clipboard.writeText(text);
    Scroll();
}

// the user clicked the Paste button; paste the clipboard into the equation line up to the first error
function Paste()
{
    navigator.clipboard.readText().then((text) =>
    {
        // for each equation line in the clipboard...
        var lines = text.split(/[\r\n]+/);
        for (var i = 0; i < lines.length; i++) {
            if (! lines[i].match(/^[[=]/) && ! lines[i].match(/^(un)?defined/) && ! lines[i].match(/^Caution/) && ! lines[i].match(/^Delete/) && ! lines[i].match(/^Mismatch/)) {
                // evaluate the equation line
                document.getElementById("equation").value = lines[i];
                // if the evaluation failed...
                if (! Enter()) {
                    // don't evaluate any more equation lines
                    break;
                }
            }
        }
    });
    Scroll();
}

var untestedexamples = `
`;

var testedexamples =`
    100 lbf * 60 mph ? hp | = 16 hp
    1 cup * 1.59 gram/cc ? lb  # weight of sugar | = 0.829325 lb
    35 ft * 20 meters ? acres | = 0.0527224 acres
    1/sqrt(23 millihenry * 10 microfarad) ? Hz  # frequency of LC oscillator | = 331.861 Hz
    60 PiB/month ? Gbps  # fast network bandwidth | = 205.644 Gbps
    20000 btu/hour; 80% * 14 megajoules/day/meter^2 ? ft^2  # solar collector size | = 486.71 ft^2
    2 packs; 30 rolls/pack; 425 sheets/roll; 40 sheets/poop; 1 poops/person/day; 3 persons ? months | = 6.9863 months
    pi * (0.25 inch)^2; 60 ft; 5 gal/min ? sec  # time for hot water to flow thru 1/2 inch pipe | = 7.34398 sec
    40 gal; 120 degF - 45 degF; 1 cal/cc deltaC; 40000 btu/hr ? min  # water heater recovery time | = 37.5291 min
    2000 lbm * grav * 60 mph ? hp  # power to decelerate car at 1G | = 320 hp
    10 mph * 30 feet * 10 gal/acre ? gal/min  # fertilizer flow rate on tractor swath | = 6.06061 gal/min
    40 knot / (2500 rpm * 90%) ? inch/rev  # propeller pitch | = 21.604 inch/rev
    (3/4) cup * 1 cal/(cc deltaK) * (212 - 52) deltaF / (2 min + 4 sec) ? watt  # measured power of microwave oven | = 532.196 watt
    10 km/l ? mpg | = 23.5215 mpg
    (3/(4 pi) * 1 gal)^(1/3) ? inches  # radius of a gallon sphere | = 3.80634 inches
    (50 ft * 30 ft * 0.75 inches/week) / (5 gal/min) ? hours/week  # lawn sprinkler time | = 2.33766 hours/week
    40 gal * 1 cal/(cc deltaK) * (140-45) deltaF / (40000 btu/hour) ? hour  # water heater recovery time | = 0.79228 hour
    1/2 * 2000 lbm * ((60 mph)^2 - (55 mph)^2) / 10 sec ? hp  # measured power drag on car | = 6.98976 hp
    3.4 mega byte / 1200 baud ? hour  # slow network time | = 6.2963 hour
    6.98976 hp; 3500 rpm ? ft lb  # convert power to torque | = 10.4889 ft lb
    (1 gallon)^(1/3) ? inches  # width of a gallon cube | = 6.13579 inches
`;

var example = 0;

// the user clicked the Example button; copy an example equation to the equation line
function Example()
{
    // get all the example lines, including blanks
    var lines = (untestedexamples+testedexamples).split(/[\r\n]+/);
    var line;
    // recall the next non-blank example line, without comments
    do {
        line = lines[example%lines.length].replace(/[|].*/, "").trim();
        example++;
    } while (! line);
    document.getElementById("equation").value = line;
    Scroll();
}

var pre_equations =`
Cd=1
`;

var post_equations =`
Cd=
`;

var equations =`
    # Geometrical
    [Length] [Length] ? [Area]  # area of rectangle | = 1 [Area]
    (1/2) [Length] [Length] ? [Area]  # area of triangle | = 0.5 [Area]
    pi [Radius]^2 ? [Area]  # area of circle | = 3.14159 [Area]
    4 pi [Radius]^2 ? [Area]  # area of sphere | = 12.5664 [Area]
    [Length] [Length] [Length] ? [Volume]  # volume of a rectangular prism | = 1000 [Volume]
    (1/3) [Length] [Length] [Length] ? [Volume]  # volume of a pyramid | = 333.333 [Volume]
    pi [Radius]^2 [Length] ? [Volume]  # volume of cylinder | = 3141.59 [Volume]
    (4/3) pi [Radius]^3 ? [Volume]  # volume of sphere | = 4188.79 [Volume]
    sqrt([Length]^2 + [Length]^2) ? [Length]  # length of hypotenuse | = 1.41421 [Length]

    # Electrical
    [Current] [Resistance] ? [Voltage]  # ohm's law | = 1 [Voltage]
    [Current]^2 [Resistance] ? [Power]  # joule's law | = 1 [Power]
    [Voltage] [Current] ? [Power] | = 1 [Power]
    [Voltage]^2 / [Resistance] ? [Power] | = 1 [Power]
    [Resistance] + [Resistance] ? [Resistance]  # series resistors | = 2 [Resistance]
    1/(1/[Resistance] + 1/[Resistance]) ? [Resistance]  # parallel resistors | = 0.5 [Resistance]
    1/(1/[Capacitance] + 1/[Capacitance]) ? [Capacitance]  # series capacitors | = 0.5 [Capacitance]
    [Capacitance] + [Capacitance] ? [Capacitance]  # parallel capacitors | = 2 [Capacitance]
    0.5 [Capacitance] [Voltage]^2 ? [Energy]  # capacitor energy | = 0.5 [Energy]
    [Inductance] + [Inductance] ? [Inductance]  # series inductors | = 2 [Inductance]
    1/(1/[Inductance] + 1/[Inductance]) ? [Inductance]  # parallel inductors | = 0.5 [Inductance]
    0.5 [Inductance] [Current]^2 ? [Energy]  # inductor energy | = 0.5 [Energy]
    1/sqrt([Inductance] [Capacitance]) ? [Frequency]  # frequency of LC oscillator | = 0.159155 [Frequency]
    
    # Mechanical
    0.5 [Mass] [Speed]^2 ? [Energy]  # kinetic energy | = 0.5 [Energy]
    [Mass] grav [Height] ? [Energy]  # potential energy | = 9.80665 [Energy]
    [Force] [Length] ? [Energy] | = 1 [Energy]
    [Force] [Speed] ? [Power] | = 1 [Power]
    [Energy] / [Time] ? [Power] | = 1 [Power]
    [Stiffness] [Length] ? [Force] | = 1 [Force]
    [Stiffness] [Length]^2 ? [Energy] | = 1 [Energy]
    [Mass] [Acceleration] ? [Force]  # newton's second law | = 1 [Force]
    [Mass] [Acceleration] [Speed] ? [Power] | = 1 [Power]
    [Mass] [Acceleration] [Length] ? [Energy] | = 1 [Energy]
    [Mass] [Speed] ? [Momentum] | = 1 [Momentum]
    [Force] [Radius] ? [Torque] | = 1 [Torque]
    [Angular_velocity] [Radius] ? [Speed] | = 1 [Speed]
    [Angular_velocity]^2 [Radius] ? [Acceleration] | = 1 [Acceleration]

    # Fluid_mechanical
    [Density] grav [Height] ? [Pressure]  # static head pressure | = 9806.65 [Pressure]
    0.5 [Cd] [Density] [Speed]^2 [Area] ? [Force]  # dynamic drag force | = 500 [Force]

    # Orbit_mechanical
    G [Mass] [Mass] / [Radius]^2 ? [Force]  # force of attraction | = 6.67259e-11 [Force]
    sqrt(2 G [Mass] / [Radius]) ? [Speed]  # escape speed | = 0.0000115521 [Speed]
    G [Mass] [Mass] / (2 [Radius]) ? [Energy]  # orbital kinetic energy | = 3.33629e-11 [Energy]
    -G [Mass] [Mass] / [Radius] ? [Energy]  # orbital potential energy | = -6.67259e-11 [Energy]

    # Nuclear
    [Mass] c^2 ? [Energy] | = 89875500000000000 [Energy]
`;

// the user clicked an equation group; show equations
function EquationsByGroup(group)  // or "All Equations"
{
    var found = group == "All Equations";
    var lines = equations.split(/[\r\n]+/);
    var html = "";
    for (var i = 0; i < lines.length; i++) {
        var line = lines[i].replace(/[|].*/, "").trim();
        if (line.length) {
            if (group != "All Equations" && line[0] == '#') {
                found = line.replace(/[#] */, "") == group;
            } else {
                if (found) {
                    html += "<br>" + History(line.trim());
                }
            }
        }
    }

    // append a deletable chunk to the results list with the equations list
    document.getElementById("results").innerHTML += Chunk("=== equations in group " + group + " ===" + html);
    Scroll();
}

// the user clicked the Equations button; show equation groups
function Equations()
{
    var lines = equations.split(/[\r\n]+/);
    var html = "<br><a href=\"javascript:EquationsByGroup('All Equations')\">All Equations</a>";
    var groups = [];
    for (var i = 0; i < lines.length; i++) {
        var line = lines[i].trim();
        if (line[0] == '#') {
            groups.push(line.replace(/# */, ""));
        }
    }
    Sort(groups);
    for (i = 0; i < groups.length; i++) {
        html += "<br>" + "<a href=\"javascript:EquationsByGroup('" + groups[i] + "')\">" + groups[i] + "</a>";
    }

    // append a deletable chunk to the results list with the equation groups list
    document.getElementById("results").innerHTML += Chunk("=== equation groups ===" + html);
    Scroll();
}

// load units from a local file
function LoadLocal()
{
    document.getElementById("file").click();
}

var remotes = [ "solarsys.js" ];

// load units from where calchemy.html was found
function LoadRemote(file)
{
    var head = document.getElementsByTagName('head')[0];
    var script = document.createElement('script');
    script.src = file;
    script.type = 'text/javascript';
    head.append(script);
}

// the user clicked the Load button; load optional units
function Load()
{
    // compute the list of hyperlinked databases
    var html = "<br><a href=\"javascript:LoadLocal()\">Local Database</a>";
    for (var i = 0; i < remotes.length; i++) {
        html += "<br>" + "<a href=\"javascript:LoadRemote('" + remotes[i] + "')\">" + remotes[i] + "</a>";
    }

    // append a deletable chunk to the results list with the categories list
    document.getElementById("results").innerHTML += Chunk("=== unit databases ===" + html);
    Scroll();
}

var tests =`
    # values and units
    |
    .3 | = 0.3
    0.3 | = 0.3
    3e-1 | = 0.3
    3e-1 | = 0.3
    300 | = 300
    3e2 | = 300
    $ ? $ | = 1 $
    % | = 0.01
    .444444444444 | = 0.444444
    .555555555555 | = 0.555556
    meter?metre | = 1 metre
    speed_of_light ? c | = 1 c
    metre?meter | = 1 meter
    c ? speed_of_light | = 1 speed_of_light
    12345678901234567890123456789012345678901234567890123456789012345678901234567890 | = 1.23457e+79

    # prefixes
    kilo | = 1000
    #k | = 1000  -- XXX we'd like this to work, at least alone!
    kibimeter | uncanceled free unit kibimeter
    Kimeter | uncanceled free unit Kimeter
    kibibyte | [Storage]
    KiByte | [Storage]

    # precedence and associativity
    2*(3+4) | = 14
    (2*3)+4 | = 10
    2+3*4 | = 14
    2*3+4 | = 10
    (4^2)^3 | = 4096
    4^(2^3) | = 65536
    4^2^3 | = 65536
    1/2?4 | = 0.125 4
    1?2/4 | = 2 2/4
    1 2/4 | = 0.5
    1/2 4 | = 0.125
    ({2})[(4)] | = 8
    (1+(2+3)*(1+2)) | = 16
    -3 | = -3
    --3 | = 3
    ---3 | = -3
    (-2)(+2) | = -4
    (-2)(-2) | = 4
    -foot-foot ? inch | = -24 inch
    (-foot)(-foot) ? sqft | = 1 sqft
    -foot^2 ? sqft | = 1 sqft
    -foot*2 ? foot | = -2 foot
    0+foot | [Length or Radius or Height]
    0-foot | [Length or Radius or Height]
    cal per gm deltaK | [Specific_heat_m]
    1/3 cal per gm deltaK | [Specific_heat_m^-1]
    m per sec per sec | [Acceleration]
    1/m per sec per sec | [Acceleration^-1]

    # functions
    3 3 | = 9
    square 2 | = 4
    square(3 3) | = 81
    square 3 3 | = 27
    cubic 2 | = 8
    cubic(2 2) | = 64
    cubic 2 2 | = 16
    sqrt 64 | = 8
    sqrt(4 4) | = 4
    sqrt 4 4 | = 8
    sin(pi/2) | = 1
    cos(pi/4) | = 0.707107
    tan(pi/4) | = 1
    asn(1) ? radian | = 1.5708 radian, Caution: Calculation involves units of cycle or revolution; see Calchemy Help.
    acs(1/sqrt(2)) ? degrees | = 45 degrees
    atn(1) ? grad | = 50 grad
    ln(e) | = 1
    log(10) | = 1
    exp(1) | = 2.71828
    sqrt[4] | = 2
    sqrt{4} | = 2

    # alternation
    1;1;1 | = 1
    2;3;4 | = 24, = 1.5, = 0.666667, = 0.0416667, = 2.66667, = 0.166667, = 6, = 0.375

    # smoke test
    57*84|=4788
    60mph ? fps | = 88 fps
    speed_of_light ? meter/second | = 299792000 meter/second
    speed_of_light ? mph | = 670617000 mph
    2;3 | = 6, = 0.666667, = 1.5, = 0.166667
    lb | [Mass], [Force]
    ft | [Length or Radius or Height]
    21 inches * 0.25 acre ? gallons | = 142560 gallons
    gal^.33333333 | [Length or Radius or Height]
    square mm * 1000^2 ? square m | = 1 square m

    # free units and plurals
    2 dogs * 1 cat/dog ? cats | = 2 cats
    2 ponies * 1 box/pony ? boxes | = 2 boxes
    meter ? meters | = 1 meters
    metres ? meter | = 1 meter
    miles ? inches | = 63360 inches
    anches ? anch | = 1 anch
    anch ? anches | = 1 anches
    andies ? andy | = 1 andy
    andy ? andies | = 1 andies

    # variables
    foo=
    foo=2;3
    foo | = 6, = 0.666667, = 1.5, = 0.166667
    foo=
    foo | uncanceled free unit foo
    boo=
    boo=ft lb
    boo | [MASS*LENGTH], [Energy or Torque]
    boo=
    boo | uncanceled free unit boo
    boo = ft lb ? Torque
    boo | [Energy or Torque]
    boo=
    boo | uncanceled free unit boo
    goo=
    goo = 1
    goo | = 1
    goo =
    goo | uncanceled free unit goo
    Mass =
    Mass | [Mass]
    Mass = Length
    Mass | [Mass], [Length or Radius or Height]
    Mass =
    Mass | [Mass]
    abc=
    abc=1
    abc = 2
    abc | = 1, = 2
    abc=2lb
    abc=?Force
    abc | = 1, = 2
    abc= ?1
    abc | [Mass]
    abc=
    person; person; person | uncanceled free unit person

    # multi-line examples
    volume=
    volume = 8 feet * 7 feet * 8 inch ? gal
    volume; (1 cal/cc deltac) (90 - 50) deltaf / 400 watt ? day | = 2.84411 day
    volume=
    seed=
    seed=2cc
    1 seed/square foot; 200 acre ? bushels | = 494.451 bushels
    seed=
    flow,power=
    flow = 1 acre * 2 inches / 1 day ? cfm
    power = (flow * 1 gram/cc) * (9.81 m/s^2) * (100 feet) ? hp
    power / 110 volts ? amps | = 6.46784 amps
    1 acre; 2 inches; 1 day; d_water; grav; 100 feet; 110 volts ? amps | = 6.46563 amps
    flow,power=
    scalecm=
    scalecm=2000 ft
    3.2 scalecm * 4.8 scalecm ? acres | = 1410.47 acres
    scalecm=
    1&2&3|= 1, = 2, = 3

    # temperatures
    25 degC ? degF | = 77 degF , Caution: Calculation involves offset temperature units; see Calchemy Help.
    77 degF ? degC | = 25 degC

    # si  -- XXX seems weird these are passed up as mismatch string with "= "...
    lb? | = 0.453592 kilogramm,= 4.44822 newton
    1? | = 1
    3 foot/2 second | [Speed]
    3 foot/2 second ? | = 0.4572 meter per second
    3 lbf * 3 foot ? | = 12.2024 joule, = 12.2024 newton meter
    joule*meter | [MASS*LENGTH^3*TIME^-2]
    joule*meter?|= 1 kilogramm*meter^3*second^-2
    shm_water?|= 4184 joule per (kilogramm*deltaK)
    $?|= 1 MONEY
    1kgm^4 | [MASS^4]
    1kgm^4? | = 1 kilogramm^4
    1m^4 | [LENGTH^4]
    1m^4? | = 1 meter^4
    1/grav? | = 0.101972 (meter per second^2)^-1
    1/sqrt(23 millihenry * 10 microfarad) ? | = 331.861 hertz, = 2085.14 radian per second

    # dimensions
    Length | [Length or Radius or Height]
    Length ? 1 | Dimensional Mismatch [Length^-1 or Radius^-1 or Height^-1]
    cup^(1/3) | [Length or Radius or Height]
    acre^(1/2) | [Length or Radius or Height]
    s?1 | Dimensional Mismatch [Frequency or Angular_velocity or Time^-1]
    s | [Time or Frequency^-1 or Angular_velocity^-1]
    s? | = 1 second
    kgm | [Mass]
    kgm? | = 1 kilogramm
    1 kgm?1 | Dimensional Mismatch [Mass^-1]
    kgm? | = 1 kilogramm
    kg | [Mass], [Force]
    kg? | = 1 kilogramm, = 9.80665 newton
    kg?1 | Dimensional Mismatch [Mass^-1], Dimensional Mismatch [Force^-1]
    kg? | = 1 kilogramm, = 9.80665 newton

    # unit help
    TEST details lb | === unit details lb ===,Common:lbm,poundm,lb*,pound*=453.592 gm [Mass], Common:lbf,poundf,lb*,pound*=1 lbm*grav [Force]
    TEST details ft | === unit details ft ===,Common:ft,foot,feet=12 in [Length or Radius or Height]
    TEST details kilobyte | === unit details kilobyte ===,PREFIX Prefix:k,kilo=1E+03*Common:byte*,Byte*,B,char*=8 bit #computer storage [Storage]
    TEST byname lb | === units by name lb ===,lb,lbf,lbm
    TEST byname ft | === units by name ft ===, ft , fT , ftesla , ftlb , fton_explosive, fton_metric , ftonf_metric , ftonm_metric , ftonne , ftonnef , ftonnem , ftorr
    TEST byname kilobyte | === units by name kilobyte ===,kilobyte,kiloByte
    TEST byname W | === units by name W ===,W,watt,Wb,weber,week,wh,Wh,wk
    TEST bycategory Torque | === units in category Torque ===, ftlb, inlb
    TEST bycategory Angle | === units in category Angle ===, arcmin, arcsec, cycle, deg, degree, grad, grade, rad, radian, rev, revolution
    TEST bycategory abc | === units in category abc ===
    TEST bycategory Angular_velocity | === units in category Angular_velocity ===, cps, hertz, Hz, rpm, rps
    TEST bydimension Fuel_efficiency | === units in category Fuel_efficiency ===, mpg
`;

var teststhatmaythrow = `
    # errors that may throw
    TEST throw | unknown test throw
    TEST details abc | undefined unit abc
    TEST byname abc | undefined unit abc
    3/0 | = Infinity
    3**2 | expected a value before *
    tricycles | uncanceled free unit tricycle
    gal^.33 | non-integral exponent
    sqrt(meter) | non-integral exponent
    1^meter | non-dimensionless exponent
    foot+second | addition of dissimilar units
    foot-second | subtraction of dissimilar units
    boo = abc | undefined unit abc
    ( | unmatched parenthesis (
    sin | missing argument sin
    sin(1 meter) | non-dimensionless exponent
    *2 | expected a value before *
    BASE | missing unit
    ^=0 | unexpected ^
    =0 | missing name
    () | missing expression
    [(0) | unmatched parenthesis [
    [(0]) | unmatched parenthesis [
    ([0)] | unmatched parenthesis (
    ?? | ? may only occur once
    :: | : may only occur once
    == | = may only occur once
    ww:q=1 | undefined category ww
    asn(2000 lb; 65 hp - 12 hp; 55 mph) ? degrees | = 10.4095 degrees
    1/sqrt(23 mi:li) | bad token :
    q=1?xyz | bad unit filter
    foot+0 | addition of dissimilar units
    foot-0 | subtraction of dissimilar units

    # multi-line examples
    area,power=
    area = (20 ft * 8 ft * 2) + (20 ft * 7 ft * 2) + (7 ft * 8 ft * 2) ? Area
    power=area * (30 deltaf) / 11 rvalue ? Power
    (20 lb * 37e6 btu/ton) / power ? day | = 7.93929 day
    area,power=
`;

// the user clicked the Test button; run the unit test
function Test()
{
    // append a temporary deletable chunk to the results list with the test in progress
    lasttag = "";
    document.getElementById("results").innerHTML += Chunk("tests started ...");
    Scroll();
    setTimeout(TestReal, 100);  // XXX -- why does 0 not work?
}

// run the unit test for real, after the display renders that tests have started
function TestReal()
{
    try {
        var lines = (tests+testedexamples+pre_equations+equations+post_equations+database_tests+teststhatmaythrow+database_teststhatmaythrow).split(/[\r\n]+/);
        testing = true;
        offset_warn = false;
        offset_warned = false;
        cycle_warn = false;
        cycle_warned = false;

        var tested = 0;
        var passed = 0;
        var firsttag = lasttag;

        var html = "";

        // for all tests...
        for (var i = 0; i < lines.length; i++) {
            tested++;

            // get the test equation line and expected results on either side of the '|'
            var line = lines[i].replace(/^ *[#].*/, "").trim();  // # for comment only at beginning of line
            console.log("Test " + line);
            var sides = line.split('|');
            if (sides.length >= 3) {
                html += "<br>test failed: " + line + " -- | may only occur once";
                continue;
            }

            // run the test
            lasttag = "";
            document.getElementById("equation").value = sides[0];
            Enter();
            var output = SnoopAndDelete(lasttag);
            
            // if we have expected output...
            if (sides.length == 2) {
                // verify that the expected output matches
                var expected = sides[1].split(',');
                if (output.length == 0 && (expected.length == 0 || (expected.length == 1 && expected[0] == ""))) {
                    // ignore split weirdness with no input
                } else {
                    // if the actual output did not match the expected output...
                    if (output.join().replace(/  */g, "") != expected.join().replace(/  */g, "")) {
                        // the test failed!
                        html += "<br>test failed: " + line + " -- expected: " + expected.toString() + " output: " + output.toString();
                        continue;
                    }
                }
                passed++;
            } else {
                // no expected output
                passed++;
            }
        }

        // replace the temporary deletable chunk in the results list with the actual test results
        Delete(firsttag);
        document.getElementById("results").innerHTML += Chunk(html + "<br>tests started ... tests complete " + Math.trunc(passed*100/tested) + "% of " + tested + " passed");
    } catch (error) {
        document.getElementById("results").innerHTML += Chunk(error);
    } finally {
        offset_warn = false;
        offset_warned = false;
        cycle_warn = false;
        cycle_warned = false;
        testing = false;
    }
    Scroll();
}

var help =`
<h1 id='toc'>Calchemy&trade; -- Math Magic</h1>
<ul>
<li><a href=#overview>Overview</a>
<ul>
    <li><a href=#basic>Basic Features</a></li>
    <li><a href=#advanced>Advanced Features</a>
    <ul>
        <li><a href=#solve>Solve By Dimensional Analysis</a>
        <li><a href=#overload>Overloaded Units</a>
        <li><a href=#free>Free Units</a>
        <li><a href=#plural>Pluralized Units</a>
    </ul>
</ul>
<li><a href=#syntax>Equation Syntax</a></li>
<li><a href=#definition>Definition Syntax</a></li>
<li>
<a href=#ui>User Interface</a>
<ul>
    <li><a href=#history>History List</a></li>
    <li><a href=#line>Equation Line</a></li>
    <li><a href=#buttons>Buttons</a></li>
</ul>
</li>
<li><a href=#examples>Examples</a></li>
<li><a href=#database>Database Notes</a></li>
<ul>
    <li><a href=#custom>Custom Database</a></li>
    <li><a href=#runtime>Runtime Database</a></li>
</ul>
<li><a href=#cautions>Cautions</a></li>
<li><a href=#info>For More Information</a></li>
</ul>

<h1 id='overview'>Overview</h1>
<p>Calchemy&trade; is an exciting not-so-new calculator which allows you to perform dimensional arithmetic, analysis, and conversions using any standard units.
Calchemy "understands" the relationships between these units and performs conversions for you automatically as needed.
It also checks your equations to ensure that they are always dimensionally correct.
<p>Always double-check your answers!
<p>The following examples provide a brief introduction to some of Calchemy's features.
<h2 id='basic'>Basic Features</h2>
<p>To perform a simple unit conversion, such as 3 meters converted to inches, you could enter the equation (or click/tap on the link):
<p><a href="javascript:Hyperlink('3 meter ? inch')">3 meter ? inch</a>
<p>Calchemy would respond:
<p>= 118.110 inch
<p>To calculate the required horsepower for a motor which could raise a 2000 lbf elevator to the top of a 10 story building (assuming 12 feet per story) in 1 minute,
you could enter the equation:
<p><a href="javascript:Hyperlink('2000 lbf * (10 * 12 feet) / 1 minute ? horsepower')">2000 lbf * (10 * 12 feet) / 1 minute ? horsepower</a>
<p>Indicating that you want to multiply 2000 pounds force by 10 times 12 feet, divide that by 1 minute, and then express the final result in horsepower.
Calchemy would respond:
<p>= 7.27273 horsepower
<p>If, on the other hand, you had made a mistake in the original equation and left out the "/ 1 minute":
<p><a href="javascript:Hyperlink('2000 lbf * (10 * 12 feet) ? horsepower')">2000 lbf * (10 * 12 feet) ? horsepower</a>
<p>Calchemy would have responded with a Dimensional Mismatch indication containing:
<p>Time^-1
<p>Indicating that the left hand side of the equation was missing a factor of 1/Time -- the equation was not dimensionally correct, and therefore, could not be evaluated.
<p>Calchemy can also be used as a simple dimensionless calculator by eliminating the "?" and result unit from the equation. For example, you could enter the equation:
<p><a href="javascript:Hyperlink('2+3*5')">2+3*5</a>
<p>Calchemy would respond with the algebraically correct answer:
<p>= 17
<h2 id='advanced'>Advanced Features</h2>
<p>You could also enter the original equation in the following less explicit form:
<p><a href="javascript:Hyperlink('2000 lb; 10 stories; 12 feet/story; 1 minute ? horsepower')">2000 lb; 10 stories; 12 feet/story; 1 minute ? horsepower</a>
<p>Indicating that you want to "combine" 2000 pounds, 10 stories, 12 feet/story, and 1 minute in such a way that the equation is dimensionally correct,
and then express the final result in horsepower.
Calchemy would again respond:
<p>= 7.27273 horsepower
<p>This example illustrates the following features:
<h3 id='solve'>Solve By Dimensional Analysis</h3>
<p>The "<b>;</b>" operator tells Calchemy to use dimensional analysis to determine whether its operands should be in the numerator or the denominator of the equation.
In this example, Calchemy placed the first three operands in the numerator and the last operand in the denominator.
This allows you to be less involved with the actual mechanics of the equations.
<h3 id='overload'>Overloaded Units</h3>
<p>The "lb" unit is an overloaded unit, meaning that it has more than one common definition.
It is primarily defined as "lbm" (pounds mass) and secondarily defined as "lbf" (pounds force).
Calchemy automatically uses the appropriate definition, again based on dimensional analysis.
In this example, Calchemy used "lbf".  This allows you to naturally use units with multiple common definitions.
<h3 id='free'>Free Units</h3>
<p>The "stories" and "story" units are called free units.
Free units are units which are not actually understood by Calchemy, except in that they are new and unique dimensions which must "cancel out" in the end.
This allows you to enter equations in a more natural format.
<h3 id='plural'>Pluralized Units</h3>
<p>The "stories" and "story" units also illustrate that Calchemy understands basic pluralization rules for units.
This, again, allows you to enter equations in a more natural format.

<h1 id='syntax'>Equation Syntax</h1>
<p>Basic Calchemy equations are of the form:
<p><b>expression ? unit</b>
<p>Where <b>expression</b> is the arithmetic expression you want evaluated, and <b>unit</b> is the unit you want the result expressed in.
<p>To evaluate an expression with a dimensionless result, use the form:
<p><b>expression</b>
<p>To evaluate an expression with a dimensionally consistent (though possibly wrong, see <a href=#cautions>Cautions</a>) SI result unit chosen by Calchemy, use the form:
<p><b>expression ?</b>
<p>Equations may contain the following binary operators (listed in decreasing order of precedence):
<table border=1>
<tr><td>Operator...</td><td>Meaning...</td></tr>
<tr><td>^</td><td>exponentiation</td></tr>
<tr><td></td><td>implied multiplication</td></tr>
<tr><td>per</td><td>unit division</td></tr>
<tr><td>* /</td><td>multiplication, division</td></tr>
<tr><td>+ -</td><td>addition, subtraction</td></tr>
<tr><td>;</td><td>solve by dimensional analysis</td></tr>
</table>  
<p>All operators except "^" are left-associative; "^" is right-associative.
<p>"+" and "-" can also be used as highest-precedence right-associative unary operators.
<p>Side-by-side operands (with no intervening punctuation) are evaluated with an implied multiplication.
The precedence of implied multiplication is just lower than that of "^".
<p>The "per" operator performs a higher-precedence unit division, with a precedence that is just lower than that of implied multiplication.
Like implied multiplication, this can be used within a unit to keep the unit terms grouped together, like: "cal per gm deltaK".
<p>Calchemy evaluates higher precedence operators before lower precedence operators.
Left-associative operators of the same precedence are evaluated from left to right; right-associative operators of the same precedence are evaluated from right to left.
The following table illustrates these rules:
<table border=1>
<tr><td>This...</td><td>Is evaluated as...</td></tr>
<tr><td>2*3^4</td><td>2*(3^4)</td></tr>
<tr><td>2*3*4</td><td>(2*3)*4</td></tr>
<tr><td>2^3^4</td><td>2^(3^4)</td></tr>
<tr><td>1/2pi</td><td>1 / (2*pi)</td></tr>
<tr><td>3 meter / 2 seconds</td><td>(3 * meter) / (2 * seconds)</td></tr>
<tr><td>1/2 foot</td><td>1 / (2 * foot)</td></tr>
<tr><td>1/2*foot</td><td>(1/2) * foot</td></tr>
<tr><td>(1/2) foot</td><td>(1/2) * foot</td></tr>
<tr><td>1/2 foot/sec</td><td>(1 / (2 * foot)) / sec</td></tr>
<tr><td>1/2 foot per sec</td><td>1 / ((2 * foot)/sec)</td></tr>
<tr><td>1/2 foot per sec^2</td><td>1 / ((2 * foot)/(sec^2))</td></tr>
<tr><td>1/3 cal per gm deltaK</td><td>1 / ((3 * cal) / (gm * deltaK))</td></tr>
<tr><td>1/2 foot pound</td><td>1 / ((2 * foot) * pound)</td></tr>
<tr><td>1/2 foot*3 pound</td><td>(1 / (2 foot)) * (3 pound)</td></tr>
<tr><td>3 meter^2</td><td>3 * (meter^2)</td></tr>
<tr><td>3 lbm meter^2</td><td>(3 * lbm) * (meter^2)</td></tr>
<tr><td>pi (3 foot)^2</td><td>pi * ((3 foot)^2)</td></tr>
<tr><td>1 / (4 foot)(3 foot)</td><td>1/((4 foot) * (3 foot))</td></tr>
</table>
<p>Parentheses can be used to explicitly override the default precedences and associativities, and group operations.
<p>When in doubt, it is always best to parenthesize!
<p>You can enter a comment into your result history by preceding it with a pound sign, like:
<p><b># comment ...</b>
<p>You can enter multiple equations on the same line by separating then with an ampersand, like:
<p><b>equation1 &amp; equation2 ...</b>
<p>You can also enter equations directly from the calchemy.html URL, by using <b><i>URL encoding</i></b> after the query '?', like:
<p>.../calchemy.html?<b><i>urlequation</i></b>

<h1 id='definition'>Definition Syntax</h1>
<p>Basic Calchemy definitions are of the form:
<p><b>name = expression</b>
<p>Where <b>name</b> is the name of the unit whose definition is to be added and <b>expression</b> is the arithmetic expression you want evaluated.
<p>To limit definitions using a dimensional filter, use the form:
<p><b>name = expression ? filter</b>
<p>To undefine all definitions of a unit name, use the form:
<p><b>name =</b>
<p>To limit undefinitions using a dimensional filter, use the form:
<p><b>name = ? filter</b>
<p>Note when using unit definitions:
<ul>
<li>units may have multiple definitions,</li>
<li>fundamental units cannot be undefined, and</li>
<li>unit definitions and undefinitions are lost when Calchemy is reloaded!</li>
</ul>
<p>For example, if you enter:
<p><a href="javascript:Hyperlink('speed = 60 mph')">speed = 60 mph</a>
<p><a href="javascript:Hyperlink('force = 20 lb')">force = 20 lb</a>
<p><a href="javascript:Hyperlink('speed*force ? hp')">speed*force ? hp</a>
<p>Calchemy would respond:
<p>= 3.2 hp
<p>If you want to be able to refer to your newly defined unit in the plural form, define its singular as:
<p><b>name* = expression</b>

<h1 id='ui'>User Interface</h1>
<h2 id='history'>History List</h2>
<p>The History List is at the top of the user interface and grows to include all your calculated equations and results;
initially, the history list contains only the words, "loading database ... database loaded".
<p>Equations and results in the history list are hyperlinks which you can click/tap to re-enter the equation or result into the Equation Line, as a form of history recall.
<p>The history list also contains unit category names or unit names you have searched for (also as hyperlinks) as well as unit details and online help.
<p>Each entry in the history list can be deleted by clicking/tapping its &lt;Delete&gt; button;
all entries in the history list can be deleted by clicking/tapping the &lt;Delete All&gt; button at the top of the history list.
<p>N.B. The history list is cleared when you clear your browser cookies and other site data.
<h2 id='line'>Equation Line</h2>
<p>The Equation Line is below the history list and above the buttons, and is where you enter unit equations and unit definitions;
initially, the equation line contains the words, "enter expression ? unit".
<p>When you are done entering a unit equation or unit definition, press the &lt;Enter&gt; key or click/tap the &lt;Enter&gt; button to evaluate the equation or definition,
and transfer it and its results to the History List.
<p>You can use the &lt;Up Arrow&gt; and &lt;Down Arrow&gt; keys to recall previous equations and results from the history list.
<h2 id='buttons'>Buttons</h2>
The following Buttons are at the bottom of the user interface:
<dl>
<dt>&lt;Enter&gt;</dt><dd>Evaluate the equation or definition in the equation line.</dd>
<dt>&lt;Clear&gt;</dt><dd>Clear the equation line.</dd>
<dt>&lt;Find Units&gt;</dt><dd>If a portion of a unit is at the the cursor of the equation line, display all possible unit names that match the portion;
otherwise, display all unit category names;
click/tap a unit category name to display all unit names in the category;
click/tap a unit name to enter its name into the equation line at the cursor.</dd>
<dt>&lt;Unit Details&gt;</dt><dd>Display the unit details (definition and dimension) for the unit at the cursor of the equation line.</dd>
<dt>&lt;Copy&gt;</dt><dd>Copy the history list and equation line to the clipboard.</dd>
<dt>&lt;Paste&gt;</dt><dd>Paste the contents of the clipboard into the equation line, evaluating one equation at a time, stopping if an error occurs.
<br>N.B. to use this feature, the calchemy html file must be accessed either thru https or locally, and you must be running Chrome or New Edge.</dd>
<dt>&lt;Example&gt;</dt><dd>Copy an example equation into the equation line.</dd>
<dt>&lt;Equations&gt;</dt><dd>Display a list of equation groups.
Click/tap an equation group to display all equations in the group.
Click/tap an equation to enter it into the equation line at the cursor.</dd>
<dt>&lt;Load&gt;</dt><dd>Load an additional runtime units database from the local computer.</dd>
<dt>&lt;Test&gt;</dt><dd>Run the internal tests to confirm proper javascript operation.</dd>
<dt>&lt;Help&gt;</dt><dd>Display this internal online help.</dd>
</dl>

<h1 id='examples'>Examples</h1>
<p>What is the braking power required to decelerate a 2000 lbm car at 1G at 60 mph?
<p><a href="javascript:Hyperlink('2000 lbm * grav * 60 mph ? hp')">2000 lbm * grav * 60 mph ? hp</a>
<br>= 320 hp
<p>What is the flow rate required if a farmer wants to apply 10 gal/acre of fertilizer using a tractor with a speed of 10 mph and a swath width of 30 feet?
<p><a href="javascript:Hyperlink('10 mph * 30 feet * 10 gal/acre ? gal/min')">10 mph * 30 feet * 10 gal/acre ? gal/min</a>
<br>= 6.06061 gal/min
<p>What is the delay for hot water if the flow rate is 3 gal/min and the water heater is connected to the tap with 43 feet of 1/2 inch id tube?
<p><a href="javascript:Hyperlink('43 feet * (pi * (0.25 inch)^2) / (3 gal/min) ? sec')">43 feet * (pi * (0.25 inch)^2) / (3 gal/min) ? sec</a>
<br>= 8.77198 sec
<p>How long will it take a 40,000 Btu/hr water heater to heat 40 gallons of water from 45 degrees F to 140 degrees F?
<p><a href="javascript:Hyperlink('40 gal * shv_water * (140-45) deltaF / (40000 Btu/hour) ? hour')">40 gal * shv_water * (140-45) deltaF / (40000 Btu/hour) ? hour</a>
<br>= 0.792813 hour
<p>What prop pitch is required for a boat to do 40 knots at 2500 rpm, assuming 10% slip?
<p><a href="javascript:Hyperlink('40 knot / (2500 rpm * 90%25) ? inch/rev')">40 knot / (2500 rpm * 90%) ? inch/rev</a>
<br>= 21.604 inch/rev
<p>What is the frequency of an LC oscillator?
<p><a href="javascript:Hyperlink('1/sqrt(23mH; 10uF)?Hz')">1/sqrt(23mH; 10uF)?Hz</a>
<br>= 331.861 Hz
<p>How large of a solar collector do you need to heat a house with 20,000 Btu/hr assuming 80% efficiency?
(Solar insolation for Denver in February is 14 megajoules/day/square meter.)
<p><a href="javascript:Hyperlink('20000 btu/hour; 80%25 * 14 megajoules/day/square meter ? ft^2')">20000 btu/hour; 80% * 14 megajoules/day/square meter ? ft^2</a>
<br>= 486.708 ft^2
<p>How many watts is a microwave oven putting out if it can bring 3/4 cup of water from 52 degrees F to a boil in 2 minutes and 4 seconds?
<p><a href="javascript:Hyperlink('(3/4) cup * shv_water * (212 - 52) deltaF / (2 min + 4 sec) ? watt')">(3/4) cup * shv_water * (212 - 52) deltaF / (2 min + 4 sec) ? watt</a>
<br>= 532.552 watt
<p>What is the maximum angle a 2000 lb car with a 65 hp engine can climb at 55 mph, assuming 12 hp of drag at that speed:
<p><a href="javascript:Hyperlink('asn(2000 lb; 65 hp - 12 hp; 55 mph) ? degrees')">asn(2000 lb; 65 hp - 12 hp; 55 mph) ? degrees</a>
<br>= 10.4095 degrees

<h1 id='database'>Database Notes</h1>
<p>Units in the Calchemy database are case sensitive, and must be used with their proper case in equations.
<p>The &lt;Find Units&gt; button allows you to also find units that differ by case, since some units have proper definitions whose case may be surprising (like Hz and Btu).
<p>The Calchemy database contains a number of physical properties grouped by a short prefix, as follows:
<table border=1>
<tr><td>d_...</td><td>density of ...</td></tr>
<tr><td>e_...</td><td>energy of ...</td></tr>
<tr><td>hcm_...</td><td>heat of combustion by mass of ...</td></tr>
<tr><td>hcv_...</td><td>heat of combustion by volume of ...</td></tr>
<tr><td>hc_...</td><td>heat of combustion by mass or volume of ...</td></tr>
<tr><td>hfm_...</td><td>heat of fusion by mass of ...</td></tr>
<tr><td>hfv_...</td><td>heat of fusion by volume of ...</td></tr>
<tr><td>hf_...</td><td>heat of fusion by mass or volume of ...</td></tr>
<tr><td>shm_...</td><td>specific heat by mass of ...</td></tr>
<tr><td>shv_...</td><td>specific heat by volume of ...</td></tr>
<tr><td>sh_...</td><td>specific heat by mass or volume of ...</td></tr>
<tr><td>hvm_...</td><td>heat of vaporization by mass of ...</td></tr>
<tr><td>hvv_...</td><td>heat of vaporization by volume of ...</td></tr>
<tr><td>hv_...</td><td>heat of vaporization by mass or volume of ...</td></tr>
<tr><td>ss_...</td><td>speed of sound in ...</td></tr>
<tr><td>tc_...</td><td>thermal conductivity of ...</td></tr>
<tr><td>visc_...</td><td>viscosity of ...</td></tr>
</table>
<p>The Calchemy database also contains a number of derived units appended with a short suffix, as follows:
<table border=1>
<tr><td>..._m</td><td>... by mass</td></tr>
<tr><td>..._v</td><td>... by volume</td></tr>
</table>
<h2 id='custom'>Custom Database</h2>
<p>A custom database named custom.js will automatically be loaded from the location of calchemy.html.
To take advantage of this feature you will typically copy calchemy.html to a local folder, create custom.js in the same folder, and launch calchemy.html from that folder.
Custom.js must define the javascript variable "custom" as a multi-line template string containing one or more unit definitions and/or undefinitions within back-ticks, like:
<pre>
custom=&#096;
foreverandaday=1e99 years + 1 day
slowasmolasses=0.001 mph
&#096;;
</pre>
<h2 id='runtime'>Runtime Database</h2>
<p>A database from a file on the local computer may be loaded at runtime by clicking/tapping the &lt;Load&gt; button, selecting "Local Database", and browsing to the file.
The file should contain lines with one or more unit definitions and/or undefinitions, like:
<pre>
foreverandaday=1e99 years + 1 day
slowasmolasses=0.001 mph
</pre>
<p>
<p>An optional database from the location of calchemy.html may also be loaded at runtime by clicking/tapping the &lt;Load&gt; button and selecting the database in the list.
<p>Runtime unit definitions and undefinitions are lost when Calchemy is reloaded!

<h1 id='cautions'>Cautions</h1>
<p>Calchemy makes problem solving so easy that it is tempting to assume that any answer it gives you is correct.
However, as with all calculators, the answer it gives you is only as good as the data you give it.
<p>Calchemy ensures that the data you give it is dimensionally consistent. 
<p>However, there are more aspects to good data than simple dimensional consistency.
Many physical equations also include dimensionless factors like 2 pi, an efficiency, or 1/2, or involve temperature offsets.
Beware that Calchemy cannot tell if you have left out (or inadvertently included) one of these factors.
<p>You must know the physical equation for the problem you are trying to solve before entering it into Calchemy!
And you must enter any dimensionless factors into Calchemy along with the other parameters of the physical equation, as these factors are part of the physical equation!
Note that true physical equations do not specify the units used for the parameters.
If your equation demands that parameters be entered in specific units, it is not a physical equation and cannot be used with Calchemy.
(These equations usually contain some unusual conversion factor that represents the combined conversions required to make the specific units of the equation coherent.)
<h2>Units of Cycle or Revolution</h2>
<p>In Calchemy, the units for cycle and revolution are defined as 2 pi radians.
As such, the units for rpm, cps, and Hz are defined in terms of radians per unit time.
Calchemy cannot tell if you have left out or accidentally included a factor of 2 pi in your physical equation.
<h2>Units of Offset Temperature</h2>
<p>In Calchemy, the degC and degF units are defined as offsets into the Celsius and Fahrenheit temperature scales.
As such, every time you enter one of these, you can and should think of it as being instantly converted to absolute Kelvin and Rankine temperatures.
Likewise, when you ask for a result in degC or degF, the evaluated (absolute) Kelvin or Rankine temperature result is then converted back to Celsius or Fahrenheit.
Calchemy cannot tell if you have accidentally converted a temperature offset into an absolute temperature or not.
<h2>Ambiguous Dimensions</h2>
<p>Dimensions such as Torque and Energy are identical, only differing in an unspecified vector component.
Similarly, dimensions such as Pressure and Latent Heat by Volume are surprisingly identical, only differing in their use!
<h2>Numeric Precision</h2>
<p>Calchemy is not intended to be used for high precision calculations.
<p>The number of significant digits typically carried by Calchemy during the phases of its calculations are summarized in the following table:
<table border=1>
<tr><td>Phase...</td><td>Digits...</td></tr>
<tr><td>numeric input</td><td>10</td></tr>
<tr><td>calculations</td><td>10</td></tr>
<tr><td>database units</td><td>6</td></tr>
<tr><td>database physical constants</td><td>6</td></tr>
<tr><td>database physical properties</td><td>&lt;4 *</td></tr>
<tr><td>numeric results</td><td>6</td></tr>
</table>
<p>* Note that database physical properties are also limited by the fact that they are typically an average over a range of assumptions.
<p>Again, always double-check your answers!

<h1 id='info'>For More Information</h1>
<p>Visit us on the web at: <a href=http://www.calchemy.com target=_blank>http://www.calchemy.com</a>
`;

// the user clicked the Help button; show the internal help and point to calchemy.com
function Help()
{
    // append a deletable chunk to the results list with the help, replacing any existing chunk so TOC hyperlinks work
    Delete("help");
    document.getElementById("results").innerHTML += Chunk(help, "help");
    document.getElementById('toc').scrollIntoView();
    Scroll(true);
}

</script>

</body>

</html>
